




//actual script that starts media player $(document).ready(function(){
// $.getJSON('http://minnesota.publicradio.org/tools/oas_shim/index.php' , {
//     name        : 'minnesota.publicradio.org/media_player_current_live@x81',
//     cachebuster : Math.ceil(Math.random()*100000000)
// }).always(function(data) {
//     var underwriting = [];
//     if (data.statusText !== 'error') {
//         $('#adswizzBanner').html('<a target="_blank" href="' + data.click_link + '"><img src="' + data.banner + '" alt="" /></a>');
//         $('#adswizzOverlay').html('<a target="_blank" href="' + data.click_link + '"><img src="' + data.overlay + '" alt="" /></a>');
//         underwriting = [{identifier: data.identifier}];
//     }

//     // if (typeof console !== 'undefined') {
//     //     console.log(data);
//     // }

//     $('#media_wrapper').apmplayer_ui({
//         settings : {
//             autoplay : true
//         },
//         underwriting: [{identifier: data.identifier}],
//         playables : media_player_playables,
//         onMetadata : function (playable) {   //callback that can be removed or re-implemented for each different player.
//             // Hard code adswizz supported streams
//             // $.fn.adswizz_handle_metadata({
//             //  playable: playable,
//             //  triggers: {
//             //      adw_ad_preroll: {
//             //          banner: 525,
//             //          overlay: 526
//             //      },
//             //      adw_ad_midroll: {
//             //          overlay: 526
//             //      },
//             //  },
//             //  zones: $.fn.apmplayer_zones
//             // });

//             var snippet = "";
//             if (playable.program !== '') {
//                 snippet += "<h2>"+playable.program+"</h2>";
//             }
//             if (playable.title !== ''
//                 && playable.title.indexOf("null - American Public Media") === -1 && playable.title !== 'AWBreak') {
//                 snippet += "<p>"+playable.title+"</p>";
//             }
//             $('#apm_player_info').html('<h5>Now playing:</h5>'+snippet);
//         }
//     });
// });



/*
This is a hacked version of the media player init.
It deals with the fact that for the moment there isn't a cross-domain way to get the OAS / JSON info from 
http://minnesota.publicradio.org/tools/oas_shim/index.php?name=minnesota.publicradio.org/media_player_current_live@x81

Instead, we've hard-coded a data response in and are just going to work with that for development. 
*/





if (Meteor.is_client){

	 Meteor.startup(function () {
		// data = {
		// 	"status":"success",
		// 	"identifier":"apm_audio:/underwriting/ads/2_preroll_camp_lincoln_64.mp3",
		// 	"banner":"http://minnesota.publicradio.org/standard/images/mpr006/banners/uw/Camp_Lincoln_13-MPR-ad-.jpg",
		// 	"overlay":"http://minnesota.publicradio.org/standard/images/mpr006/banners/uw/Camp_Lincoln_13-MPR-ad-.jpg",
		// 	"click_link":"http://www.lincoln-lakehubert.com/?gclid=CLrIx7jzk7cCFbSMMgodagMAuw"
		// 	};
		// console.log(data);
	 //    var underwriting = [];
	 //    $('#adswizzBanner').html('<a target="_blank" href="' + data.click_link + '"><img src="' + data.banner + '" alt="" /></a>');
	 //    $('#adswizzOverlay').html('<a target="_blank" href="' + data.click_link + '"><img src="' + data.overlay + '" alt="" /></a>');
	 //    underwriting = [{identifier: data.identifier}];

	    $('#apm_media_wrapper').apmplayer_ui({
	        settings : {
	            autoplay : true
	        },
	        //underwriting: [{identifier: data.identifier}],
	        playables : [media_player_playables],
	        onMetadata : function (playable) {   //callback that can be removed or re-implemented for each different player.
	   			console.log('playable',playable);
	            var snippet = "";
	            if (playable.program !== '') {
	                snippet += "<h2>"+playable.program+"</h2>";
	            }
	            if (playable.title !== ''
	                && playable.title.indexOf("null - American Public Media") === -1 && playable.title !== 'AWBreak') {
	                snippet += "<p>"+playable.title+"</p>";
	            }
	            $('#apm_player_info').html(snippet);
	        }
	    });
	});
}
